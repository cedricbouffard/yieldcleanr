<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtre Delay Adjustment - Position-Coordinate Delay Identification • yieldcleanr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtre Delay Adjustment - Position-Coordinate Delay Identification">
<meta name="description" content="Outils pour nettoyer les données de rendement agricole / Tools for cleaning agricultural yield data">
<style>
.lang-toggle { cursor: pointer; padding: 8px 12px; }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const langToggle = document.getElementById('lang-toggle');
  if (langToggle) {
    langToggle.addEventListener('click', function(e) {
      e.preventDefault();
      const currentPath = window.location.pathname;
      const isEn = currentPath.includes('/en/') || currentPath.endsWith('_en.html');
      let newPath;
      if (isEn) {
        newPath = currentPath.replace('/en/', '/fr/').replace('_en.html', '_en.html');
      } else {
        newPath = currentPath.replace('/fr/', '/en/').replace('_fr.html', '_en.html');
      }
      if (newPath !== currentPath) {
        window.location.href = newPath;
      }
    });
  }
});
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">yieldcleanr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Référence</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Nouveautés</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cedricbouffard/yieldcleanr">GitHub</a></li>
<li class="nav-item"><a class="nav-link lang-toggle" id="lang-toggle" href="../#">FR | EN</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filtre Delay Adjustment - Position-Coordinate Delay Identification</h1>
            <h3 data-toc-skip class="subtitle">Théorie mathématique et
implémentation</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cedricbouffard/yieldcleanr/blob/main/vignettes/filtre-delai.Rmd" class="external-link"><code>vignettes/filtre-delai.Rmd</code></a></small>
      <div class="d-none name"><code>filtre-delai.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Le <strong>Delay Adjustment (Position-Coordinate Delay
Identification)</strong> est un algorithme sophistiqué qui détecte et
corrige le délai temporel entre la mesure du flux de grain et
l’enregistrement de la position GPS. Ce délai, typiquement de 2 à 15
secondes, peut créer des bandes obliques artificielles dans les cartes
de rendement.</p>
<div class="section level3">
<h3 id="problématique">Problématique<a class="anchor" aria-label="anchor" href="#probl%C3%A9matique"></a>
</h3>
<p>Lors de la moisson, le grain passe par plusieurs étapes avant d’être
mesuré : 1. <strong>Coupe</strong> par la barre de coupe 2.
<strong>Transport</strong> par la vis sans fin et les chaînes
élévatrices 3. <strong>Battage</strong> dans le cylindre 4.
<strong>Mesure</strong> par le capteur de flux</p>
<p>Ces étapes créent un <strong>délai mécanique</strong> entre le moment
où le grain est coupé (position GPS) et le moment où il est mesuré
(flux).</p>
</div>
</div>
<div class="section level2">
<h2 id="fondements-mathématiques">Fondements mathématiques<a class="anchor" aria-label="anchor" href="#fondements-math%C3%A9matiques"></a>
</h2>
<div class="section level3">
<h3 id="autocorrélation-spatiale">1. Autocorrélation spatiale<a class="anchor" aria-label="anchor" href="#autocorr%C3%A9lation-spatiale"></a>
</h3>
<p>Le Delay Adjustment utilise l’<strong>indice de Moran</strong> pour
mesurer l’autocorrélation spatiale du rendement. L’autocorrélation
spatiale mesure dans quelle mesure des points proches géographiquement
ont des valeurs de rendement similaires.</p>
<div class="section level4">
<h4 id="formule-de-lindice-de-moran">Formule de l’indice de Moran<a class="anchor" aria-label="anchor" href="#formule-de-lindice-de-moran"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mfrac><mi>n</mi><mi>W</mi></mfrac><mo>⋅</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mover><mi>y</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>j</mi></msub><mo>−</mo><mover><mi>y</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mover><mi>y</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">I = \frac{n}{W} \cdot \frac{\sum_{i=1}^{n} \sum_{j=1}^{n} w_{ij}(y_i - \bar{y})(y_j - \bar{y})}{\sum_{i=1}^{n}(y_i - \bar{y})^2}</annotation></semantics></math></p>
<p>Où : -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
= nombre d’observations -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>j</mi></msub><annotation encoding="application/x-tex">y_j</annotation></semantics></math>
= valeurs de rendement aux positions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
et
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>y</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{y}</annotation></semantics></math>
= moyenne des rendements -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
= poids spatial entre les points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
et
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W = \sum_{i=1}^{n} \sum_{j=1}^{n} w_{ij}</annotation></semantics></math>
= somme de tous les poids</p>
</div>
<div class="section level4">
<h4 id="interprétation-de-lindice-de-moran">Interprétation de l’indice de Moran<a class="anchor" aria-label="anchor" href="#interpr%C3%A9tation-de-lindice-de-moran"></a>
</h4>
<table class="table">
<thead><tr class="header">
<th>Valeur de I</th>
<th>Interprétation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>≈</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">I \approx 1</annotation></semantics></math></td>
<td>Forte autocorrélation positive (zones homogènes)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">I \approx 0</annotation></semantics></math></td>
<td>Pas d’autocorrélation (distribution aléatoire)</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">I &lt; 0</annotation></semantics></math></td>
<td>Autocorrélation négative (zones contrastées)</td>
</tr>
</tbody>
</table>
<p><strong>Objectif du Delay Adjustment</strong> : Maximiser l’indice de
Moran en trouvant le délai optimal qui aligne le flux avec la
position.</p>
</div>
</div>
<div class="section level3">
<h3 id="matrice-de-poids-spatiaux">2. Matrice de poids spatiaux<a class="anchor" aria-label="anchor" href="#matrice-de-poids-spatiaux"></a>
</h3>
<p>Les poids
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math>
sont définis par une fonction de distance :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">si </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">sinon</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">w_{ij} = \begin{cases} 
1 &amp; \text{si } d_{ij} \leq d_{max} \\
0 &amp; \text{sinon}
\end{cases}</annotation></semantics></math></p>
<p>Où
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">d_{ij}</annotation></semantics></math>
est la distance euclidienne entre les points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
et
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msqrt><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mi>y</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">d_{ij} = \sqrt{(x_i - x_j)^2 + (y_i - y_j)^2}</annotation></semantics></math></p>
<div class="section level4">
<h4 id="distance-maximale-typique">Distance maximale typique<a class="anchor" aria-label="anchor" href="#distance-maximale-typique"></a>
</h4>
<p>Pour les données de rendement,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><annotation encoding="application/x-tex">d_{max}</annotation></semantics></math>
est généralement fixé à <strong>30 mètres</strong>, ce qui correspond à
environ 3-4 passages de moissonneuse.</p>
</div>
</div>
<div class="section level3">
<h3 id="décalage-temporel-time-shift">3. Décalage temporel (Time Shift)<a class="anchor" aria-label="anchor" href="#d%C3%A9calage-temporel-time-shift"></a>
</h3>
<p>Pour chaque délai candidat
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>,
on applique un décalage au flux :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>l</mi><mi>o</mi><msub><mi>w</mi><mi>δ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>F</mi><mi>l</mi><mi>o</mi><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Flow_{\delta}(t) = Flow(t + \delta)</annotation></semantics></math></p>
<p>Le rendement corrigé devient :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><msub><mi>d</mi><mi>δ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>F</mi><mi>l</mi><mi>o</mi><msub><mi>w</mi><mi>δ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><mrow><mi>S</mi><mi>w</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo>×</mo><mi>D</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow></mfrac><mo>×</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">Yield_{\delta}(t) = \frac{Flow_{\delta}(t) \times Interval}{Swath \times Distance} \times 10000</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="score-de-corrélation-spatiale-rsc">4. Score de corrélation spatiale (RSC)<a class="anchor" aria-label="anchor" href="#score-de-corr%C3%A9lation-spatiale-rsc"></a>
</h3>
<p>Le RSC (Ratio of Spatial Correlation) est défini comme l’indice de
Moran calculé sur les données décalées :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>S</mi><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mi>i</mi><mi>e</mi><mi>l</mi><msub><mi>d</mi><mi>δ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">RSC(\delta) = I(Yield_{\delta})</annotation></semantics></math></p>
<p><strong>Délai optimal</strong> :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>δ</mi><mo>*</mo></msup><mo>=</mo><mo>arg</mo><munder><mo>max</mo><mrow><mi>δ</mi><mo>∈</mo><mi>Δ</mi></mrow></munder><mi>R</mi><mi>S</mi><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\delta^* = \arg\max_{\delta \in \Delta} RSC(\delta)</annotation></semantics></math></p>
<p>Où
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>
est la plage de délais testés (typiquement -25 à +25 secondes).</p>
</div>
</div>
<div class="section level2">
<h2 id="algorithme-delay-adjustment">Algorithme Delay Adjustment<a class="anchor" aria-label="anchor" href="#algorithme-delay-adjustment"></a>
</h2>
<div class="section level3">
<h3 id="pseudo-code">Pseudo-code<a class="anchor" aria-label="anchor" href="#pseudo-code"></a>
</h3>
<pre><code>Delay Adjustment(data, delay_range, n_iterations):
    
    # 1. Conversion en grille spatiale
    grid = create_spatial_grid(data, cell_size=10m)
    
    # 2. Pour chaque itération
    for iter in 1:n_iterations:
        
        # Échantillonnage aléatoire stratifié
        sample = grid_sample(grid, fraction=0.3, seed=iter)
        
        # Pour chaque délai candidat
        for delta in delay_range:
            
            # Appliquer le décalage temporel
            shifted_data = apply_delay(sample, delta)
            
            # Calculer le rendement
            yield = calculate_yield(shifted_data)
            
            # Calculer l'indice de Moran
            moran_score = calculate_moran(yield, distance_threshold=30m)
            
            # Stocker le score
            scores[iter, delta] = moran_score
    
    # 3. Agrégation des résultats
    mean_scores = mean(scores, axis=0)
    std_scores = sd(scores, axis=0)
    
    # 4. Sélection du délai optimal
    optimal_delay = argmax(mean_scores)
    
    return optimal_delay, mean_scores, std_scores</code></pre>
</div>
<div class="section level3">
<h3 id="implémentation-dans-yieldcleanr">Implémentation dans yieldcleanr<a class="anchor" aria-label="anchor" href="#impl%C3%A9mentation-dans-yieldcleanr"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cedricbouffard/yieldcleanr" class="external-link">yieldcleanr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Charger les données</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample2.txt"</span>, package <span class="op">=</span> <span class="st">"yieldcleanr"</span><span class="op">)</span></span>
<span><span class="va">data_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_yield_data.html">read_yield_data</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Préparation des données</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latlon_to_utm.html">latlon_to_utm</a></span><span class="op">(</span><span class="va">data_raw</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/convert_flow_to_yield.html">convert_flow_to_yield</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Appliquer Delay Adjustment avec plage étendue</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Application du Delay Adjustment ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Application du Delay Adjustment ===</span></span>
<span><span class="va">delay_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_delays.html">optimize_delays</a></span><span class="op">(</span><span class="va">data</span>, type <span class="op">=</span> <span class="st">"flow"</span>, delay_range <span class="op">=</span> <span class="op">-</span><span class="fl">25</span><span class="op">:</span><span class="fl">25</span>, n_iterations <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Délai optimal détecté:"</span>, <span class="va">delay_result</span><span class="op">$</span><span class="va">delays</span><span class="op">$</span><span class="va">flow</span>, <span class="st">"secondes\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Délai optimal détecté: 13 secondes</span></span>
<span><span class="va">optimal_rsc</span> <span class="op">&lt;-</span> <span class="va">delay_result</span><span class="op">$</span><span class="va">delay_adjustment_results</span><span class="op">$</span><span class="va">flow</span><span class="op">$</span><span class="va">rsc_values</span><span class="op">$</span><span class="va">mean_score</span><span class="op">[</span><span class="va">delay_result</span><span class="op">$</span><span class="va">delay_adjustment_results</span><span class="op">$</span><span class="va">flow</span><span class="op">$</span><span class="va">rsc_values</span><span class="op">$</span><span class="va">delay</span> <span class="op">==</span> <span class="va">delay_result</span><span class="op">$</span><span class="va">delays</span><span class="op">$</span><span class="va">flow</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">optimal_rsc</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">optimal_rsc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Score Moran moyen au délai optimal:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">optimal_rsc</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Score Moran moyen au délai optimal: NA\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Score Moran moyen au délai optimal: 0.6524</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualisation-des-résultats-delay-adjustment">Visualisation des résultats Delay Adjustment<a class="anchor" aria-label="anchor" href="#visualisation-des-r%C3%A9sultats-delay-adjustment"></a>
</h2>
<div class="section level3">
<h3 id="comparaison-avantaprès-correction">Comparaison avant/après correction<a class="anchor" aria-label="anchor" href="#comparaison-avantapr%C3%A8s-correction"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Données avant correction</span></span>
<span><span class="va">data_before</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span></span>
<span><span class="co"># Données après correction</span></span>
<span><span class="va">data_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_delays.html">optimize_delays</a></span><span class="op">(</span><span class="va">data</span>, type <span class="op">=</span> <span class="st">"flow"</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="co"># Créer les objets sf</span></span>
<span><span class="va">sf_before</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">data_before</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">sf_after</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">data_after</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Graphique comparatif</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sf_before</span><span class="op">[</span><span class="st">"Yield_kg_ha"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"AVANT correction Delay Adjustment"</span>, </span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.3</span>, breaks <span class="op">=</span> <span class="st">"jenks"</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="filtre-delai_files/figure-html/delay_adjustment-comparison-1.png" class="r-plt" alt="" width="1344"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sf_after</span><span class="op">[</span><span class="st">"Yield_kg_ha"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"APRÈS correction Delay Adjustment"</span>, </span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.3</span>, breaks <span class="op">=</span> <span class="st">"jenks"</span>, key.pos <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="filtre-delai_files/figure-html/delay_adjustment-comparison-2.png" class="r-plt" alt="" width="1344"></p>
</div>
</div>
<div class="section level2">
<h2 id="exemple-illustratif">Exemple illustratif<a class="anchor" aria-label="anchor" href="#exemple-illustratif"></a>
</h2>
<div class="section level3">
<h3 id="simulation-du-délai">Simulation du délai<a class="anchor" aria-label="anchor" href="#simulation-du-d%C3%A9lai"></a>
</h3>
<p>Pour comprendre l’effet du délai, créons une simulation simple :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Créer des données simulées avec un délai connu</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n_points</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># Trajectoire de la moissonneuse</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length.out <span class="op">=</span> <span class="va">n_points</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="va">n_points</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rendement "vrai" avec pattern spatial</span></span>
<span><span class="va">yield_true</span> <span class="op">&lt;-</span> <span class="fl">5000</span> <span class="op">+</span> <span class="fl">1000</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_points</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Flux mesuré avec délai de 5 secondes</span></span>
<span><span class="va">delay</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">yield_measured</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">delay</span><span class="op">)</span>, <span class="va">yield_true</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_points</span><span class="op">-</span><span class="va">delay</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Créer dataframe</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  yield_true <span class="op">=</span> <span class="va">yield_true</span>,</span>
<span>  yield_measured <span class="op">=</span> <span class="va">yield_measured</span>,</span>
<span>  time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_points</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualisation</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">yield_true</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Rendement\nvrai (kg/ha)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Rendement spatial 'vrai'"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Pattern régulier sans délai"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">yield_measured</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Rendement\nmesuré (kg/ha)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Rendement mesuré avec délai de 5 secondes"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Pattern décalé - bandes obliques artificielles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="filtre-delai_files/figure-html/delay_adjustment-simulation-1.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level3">
<h3 id="effet-du-délai-sur-lautocorrélation">Effet du délai sur l’autocorrélation<a class="anchor" aria-label="anchor" href="#effet-du-d%C3%A9lai-sur-lautocorr%C3%A9lation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculer Moran I pour différents délais simulés</span></span>
<span><span class="va">calculate_moran_simple</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">yield</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yield</span><span class="op">)</span></span>
<span>  <span class="va">y_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">yield</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">numerator</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">denominator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">yield</span> <span class="op">-</span> <span class="va">y_bar</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">!=</span> <span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">dist</span> <span class="op">&lt;=</span> <span class="va">threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>          <span class="va">numerator</span> <span class="op">&lt;-</span> <span class="va">numerator</span> <span class="op">+</span> <span class="va">w</span> <span class="op">*</span> <span class="op">(</span><span class="va">yield</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">y_bar</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">yield</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">-</span> <span class="va">y_bar</span><span class="op">)</span></span>
<span>          <span class="va">W</span> <span class="op">&lt;-</span> <span class="va">W</span> <span class="op">+</span> <span class="va">w</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">I</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="va">W</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">numerator</span> <span class="op">/</span> <span class="va">denominator</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Tester différents délais</span></span>
<span><span class="va">delays_test</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">10</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">moran_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">delays_test</span>, <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">d</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y_shifted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">d</span><span class="op">)</span>, <span class="va">yield_true</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_points</span><span class="op">-</span><span class="va">d</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">y_shifted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yield_true</span><span class="op">[</span><span class="op">(</span><span class="op">-</span><span class="va">d</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">n_points</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">calculate_moran_simple</span><span class="op">(</span><span class="va">y_shifted</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Graphique</span></span>
<span><span class="va">df_moran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="va">delays_test</span>, moran <span class="op">=</span> <span class="va">moran_scores</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_moran</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay</span>, y <span class="op">=</span> <span class="va">moran</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#2c3e50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"#3498db"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#e74c3c"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5.5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">moran_scores</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.05</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Délai réel: 5s"</span>, color <span class="op">=</span> <span class="st">"#e74c3c"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Détection du délai par maximisation de Moran I"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Le pic correspond au délai réel de 5 secondes"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Délai testé (secondes)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Indice de Moran"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="filtre-delai_files/figure-html/delay_adjustment-moran-effect-1.png" class="r-plt" alt="" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="interprétation-des-résultats">Interprétation des résultats<a class="anchor" aria-label="anchor" href="#interpr%C3%A9tation-des-r%C3%A9sultats"></a>
</h2>
<div class="section level3">
<h3 id="signification-des-délais">Signification des délais<a class="anchor" aria-label="anchor" href="#signification-des-d%C3%A9lais"></a>
</h3>
<table class="table">
<colgroup>
<col width="30%">
<col width="32%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th>Délai détecté</th>
<th>Interprétation</th>
<th>Action recommandée</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0 seconde</strong></td>
<td>Synchronisation parfaite</td>
<td>Aucune correction nécessaire</td>
</tr>
<tr class="even">
<td><strong>1-5 secondes</strong></td>
<td>Délai léger</td>
<td>Correction recommandée</td>
</tr>
<tr class="odd">
<td><strong>6-15 secondes</strong></td>
<td>Délai modéré</td>
<td>Correction nécessaire</td>
</tr>
<tr class="even">
<td><strong>&gt; 15 secondes</strong></td>
<td>Délai important</td>
<td>Vérifier l’équipement</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="cas-particuliers">Cas particuliers<a class="anchor" aria-label="anchor" href="#cas-particuliers"></a>
</h3>
<div class="section level4">
<h4 id="délai-négatif">Délai négatif<a class="anchor" aria-label="anchor" href="#d%C3%A9lai-n%C3%A9gatif"></a>
</h4>
<p>Un délai négatif signifie que la position GPS est enregistrée
<strong>après</strong> la mesure du flux. Cela peut arriver si : - Le
GPS a une latence élevée - La configuration des capteurs est
inversée</p>
</div>
<div class="section level4">
<h4 id="délai-variable">Délai variable<a class="anchor" aria-label="anchor" href="#d%C3%A9lai-variable"></a>
</h4>
<p>Si le délai optimal varie beaucoup entre les itérations (écart-type
élevé), cela indique : - Des données bruitées - Des patterns spatiaux
faibles - Un besoin de plus d’itérations</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="paramètres-du-delay-adjustment">Paramètres du Delay Adjustment<a class="anchor" aria-label="anchor" href="#param%C3%A8tres-du-delay-adjustment"></a>
</h2>
<div class="section level3">
<h3 id="paramètres-principaux">Paramètres principaux<a class="anchor" aria-label="anchor" href="#param%C3%A8tres-principaux"></a>
</h3>
<table class="table">
<colgroup>
<col width="17%">
<col width="20%">
<col width="30%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Paramètre</th>
<th>Description</th>
<th>Valeur par défaut</th>
<th>Plage recommandée</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>delay_range</code></td>
<td>Plage de délais testés</td>
<td><code>-25:25</code></td>
<td>
<code>-30:30</code> selon équipement</td>
</tr>
<tr class="even">
<td><code>n_iterations</code></td>
<td>Nombre d’itérations</td>
<td><code>10</code></td>
<td><code>5-20</code></td>
</tr>
<tr class="odd">
<td><code>cell_size</code></td>
<td>Taille des cellules de grille</td>
<td><code>10m</code></td>
<td><code>5-15m</code></td>
</tr>
<tr class="even">
<td><code>sample_fraction</code></td>
<td>Fraction de données échantillonnées</td>
<td><code>0.3</code></td>
<td><code>0.2-0.5</code></td>
</tr>
<tr class="odd">
<td><code>distance_threshold</code></td>
<td>Distance max pour Moran</td>
<td><code>30m</code></td>
<td><code>20-50m</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="recommandations-par-type-de-culture">Recommandations par type de culture<a class="anchor" aria-label="anchor" href="#recommandations-par-type-de-culture"></a>
</h3>
<div class="section level4">
<h4 id="culture-à-rendement-homogène-soja-blé">Culture à rendement homogène (soja, blé)<a class="anchor" aria-label="anchor" href="#culture-%C3%A0-rendement-homog%C3%A8ne-soja-bl%C3%A9"></a>
</h4>
<ul>
<li>
<code>n_iterations</code> : 10-15 (patterns clairs)</li>
<li>
<code>sample_fraction</code> : 0.3</li>
<li>Attendez-vous à des délais bien définis</li>
</ul>
</div>
<div class="section level4">
<h4 id="culture-à-rendement-variable-maïs-irrigué">Culture à rendement variable (maïs irrigué)<a class="anchor" aria-label="anchor" href="#culture-%C3%A0-rendement-variable-ma%C3%AFs-irrigu%C3%A9"></a>
</h4>
<ul>
<li>
<code>n_iterations</code> : 15-20 (plus de bruit)</li>
<li>
<code>sample_fraction</code> : 0.4</li>
<li>Le délai peut être moins marqué</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="références">Références<a class="anchor" aria-label="anchor" href="#r%C3%A9f%C3%A9rences"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Han, S. et al. (1997)</strong> - “Agricultural yield data
analysis using spatial autoregressive models”</li>
<li>
<strong>Moran, P.A.P. (1950)</strong> - “Notes on continuous
stochastic phenomena”</li>
<li>
<strong>USDA-ARS Yield Editor</strong> - Documentation technique
AYCE</li>
</ol>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Le Delay Adjustment est un outil puissant qui utilise
l’autocorrélation spatiale pour détecter et corriger les délais de
synchronisation. En maximisant l’indice de Moran, il aligne
automatiquement le flux de grain avec la position GPS, éliminant les
artefacts visuels et améliorant la qualité des cartes de rendement.</p>
<p><strong>Points clés à retenir :</strong> - L’indice de Moran mesure
l’homogénéité spatiale - Le délai optimal maximise l’autocorrélation -
Des itérations multiples assurent la robustesse - Un délai &gt; 5
secondes nécessite une correction</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cedric Bouffard.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
