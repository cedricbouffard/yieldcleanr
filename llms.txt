# yieldcleanr

[![R-CI](https://github.com/cedricbouffard/yieldcleanr/actions/workflows/R-CI.yml/badge.svg)](https://github.com/cedricbouffard/yieldcleanr/actions)
[![Codecov](https://codecov.io/gh/cedricbouffard/yieldcleanr/branch/main/graph/badge.svg)](https://codecov.io/gh/cedricbouffard/yieldcleanr)

**yieldcleanr** is an R package for cleaning, filtering, and validating
agricultural yield data collected by combine harvesters. It implements
filtering methods documented in the USDA Yield Editor and provides an
interactive Shiny application for visual data cleaning.

## Features

- **Interactive Shiny Application**: Visual interface for data cleaning
  with real-time preview
- **PCDI (Pulse Count Delay Integration)**: Automatic optimization of
  GPS-sensor delay compensation
- **Multiple Filter Types**:
  - Header status filtering (eliminates points when header is raised)
  - GPS quality filtering (GPS status, DOP values)
  - Velocity filtering (removes stationary or too-fast points)
  - Overlap filtering (filters overlapping swath areas)
  - Local standard deviation filtering (removes abnormal points in
    neighborhood)
  - Moisture and yield range filtering
- **Raster Export**: Generate interpolated raster maps with spline
  interpolation
- **Comprehensive Logging**: Detailed tracking of all cleaning
  operations
- **Multi-format Support**: Import from various yield monitor formats

## Installation

``` r
# Install from GitHub
devtools::install_github("cedricbouffard/yieldcleanr")
```

## Quick Start

### Command Line Usage

``` r
library(yieldcleanr)

# Clean yield data with default parameters
cleaned <- clean_yield_data(
  file_path = "data/yield_data.txt",
  output_file = "data/cleaned.csv",
  log_file = "data/cleaning_log.txt"
)

# Clean with custom parameters
cleaned <- clean_yield_data(
  file_path = "data/yield_data.txt",
  output_file = "data/cleaned.csv",
  log_file = "data/cleaning_log.txt",
  params = list(
    flow_delay = 2,              # GPS-sensor delay (seconds)
    moisture_delay = 15,         # Moisture sensor delay (seconds)
    min_velocity = 0.5,          # Minimum velocity (m/s)
    max_velocity = 10,           # Maximum velocity (m/s)
    yield_range = c(74, 235),    # Acceptable yield range
    moisture_range = c(10, 40),  # Acceptable moisture range
    overlap_cellsize = 0.3,      # Overlap filter cell size (m)
    overlap_limit = 50,          # Overlap threshold (%)
    std_swath = 5,               # Local SD swath count
    std_limit = 3                # Local SD threshold (std dev)
  )
)
```

### Interactive Shiny Application

``` r
# Launch the interactive cleaning application
yieldcleanr::launch_shiny_app()
```

The Shiny application provides: - Visual preview of raw and cleaned
data - Interactive parameter adjustment - Real-time filter application -
Multiple visualization modes (yield map, deleted points, raster view) -
Export to multiple formats (GeoJSON, CSV, GeoTIFF)

## Data Format

The package accepts yield data with the following columns: -
**Required**: Longitude, Latitude, Yield (kg/ha or bu/acre) -
**Optional**: Moisture (%), Flow (kg/s), Velocity (m/s), GPS Status,
Header Status, Swath Width

Example data format:

    Longitude,Latitude,Yield_kg_ha,Moisture,Flow,Velocity
    -73.5123,45.1234,8500.5,18.2,12.5,5.2
    -73.5124,45.1235,8200.3,18.1,12.3,5.1

## Filtering Pipeline

The cleaning process follows this order:

1.  **PCDI (Optional)**: Optimize GPS-sensor delay for flow and moisture
2.  **Header Status**: Remove points when header is raised
3.  **GPS Quality**: Filter by GPS status and DOP values
4.  **Velocity**: Remove stationary and high-speed points
5.  **Yield Range**: Filter yield values outside acceptable range
6.  **Moisture Range**: Filter moisture values outside acceptable range
7.  **Overlap**: Remove points in overlapping swath areas
8.  **Local Standard Deviation**: Remove statistically abnormal points

## Raster Export

Generate interpolated raster maps:

``` r
# Export cleaned data to raster
library(sf)

# Load cleaned data
data <- st_read("data/cleaned.geojson")

# Create raster with spline interpolation
raster <- export_raster(
  data = data,
  cell_size = 1,              # 1 meter resolution
  column_colonne = "Yield_kg_ha",
  crs_code = 32618           # UTM Zone 18N
)

# Save as GeoTIFF
save_raster(raster, "output/yield_map.tif")
```

The raster export uses Thin Plate Spline (TPS) interpolation for smooth,
continuous surfaces.

## Documentation

- [Getting Started](vignettes/getting-started.md) - Introduction and
  basic usage
- [Filtering Methods](vignettes/filtering-methods.md) - Detailed
  explanation of filters
- [Shiny Application](vignettes/shiny-app.md) - Guide to the interactive
  app
- [API Reference](reference/index.md) - Function documentation

## Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](CONTRIBUTING.md)
for guidelines.

1.  Fork the repository
2.  Create a feature branch (`git checkout -b feature/amazing-feature`)
3.  Commit your changes (`git commit -m 'Add amazing feature'`)
4.  Push to the branch (`git push origin feature/amazing-feature`)
5.  Open a Pull Request

## Citation

If you use this package in your research, please cite:

    Bouffard, C. (2025). yieldcleanr: Tools for cleaning and validating
        agricultural yield data. R package version 0.1.0.

## License

This project is licensed under the MIT License - see [LICENSE](LICENSE)
for details.

## Acknowledgments

- USDA Yield Editor documentation for filtering methodology
- The R-spatial community for spatial analysis tools
- Contributors and testers

## Contact

- **Issues**: [GitHub
  Issues](https://github.com/cedricbouffard/yieldcleanr/issues)
- **Email**: <cedric.bouffard@irda.qc.ca>

------------------------------------------------------------------------

**Note**: This package is under active development. Please report any
issues or feature requests on GitHub.

# Package index

## Fonctions Principales

Fonctions principales pour nettoyer les données de rendement

- [`clean_yield()`](clean_yield.md) : Fonction unifiee de nettoyage des
  donnees de rendement
- [`clean_yield_with_tracking()`](clean_yield_with_tracking.md) :
  Nettoyage des donnees de rendement avec suivi des suppressions
- [`read_yield_data()`](read_yield_data.md) : Lire des donnees de
  rendement brutes depuis un fichier texte
- [`launch_shiny_app()`](launch_shiny_app.md) : Lancer l'application
  Shiny de nettoyage des rendements

## AYCE - Auto Yield Cleaning Engine

Fonctions du moteur de nettoyage automatique AYCE

- [`ayce_clean()`](ayce_clean.md) : AYCE : Auto Yield Cleaning Engine
  (sortie imperiale)
- [`ayce_sf()`](ayce_sf.md) : Pipeline AYCE complet avec sortie SF

## Application des Filtres

Fonctions pour appliquer les filtres de nettoyage

- [`apply_flow_delay()`](apply_flow_delay.md) : Appliquer la correction
  de delai de flux
- [`apply_local_sd_filter()`](apply_local_sd_filter.md) : Filtre
  d'ecart-type localise
- [`apply_moisture_delay()`](apply_moisture_delay.md) : Appliquer la
  correction de delai d'humidite
- [`apply_overlap_filter()`](apply_overlap_filter.md) : Filtre de
  chevauchement base sur un bitmap
- [`apply_pcdi()`](apply_pcdi.md) : PCDI : Phase Correlation Delay
  Identification
- [`apply_position_filter()`](apply_position_filter.md) : Appliquer le
  filtre de position (POS)

## Filtres de Données

Fonctions de filtrage des données de rendement

- [`filter_bounds()`](filter_bounds.md) : Filtrer selon les limites
  geographiques
- [`filter_dop()`](filter_dop.md) : Filtrer selon le DOP (Dilution of
  Precision)
- [`filter_gps_status()`](filter_gps_status.md) : Filtrer selon le
  statut GPS
- [`filter_header_status()`](filter_header_status.md) : Filtrer selon le
  statut du header
- [`filter_heading_anomalies()`](filter_heading_anomalies.md) : Filtre
  pour variations brusques de direction du header
- [`filter_local_std()`](filter_local_std.md) : Appliquer le filtre ET
  local
- [`filter_moisture_range()`](filter_moisture_range.md) : Filtrer selon
  la plage d'humidite
- [`filter_sliding_window()`](filter_sliding_window.md) : Appliquer le
  filtre a fenetre glissante
- [`filter_velocity()`](filter_velocity.md) : Filtrer selon la plage de
  vitesse
- [`filter_velocity_jumps()`](filter_velocity_jumps.md) : Filtre pour
  changements brusques de vitesse
- [`filter_yield_range()`](filter_yield_range.md) : Filtrer selon la
  plage de rendement

## Calculs et Statistiques

Fonctions de calcul et analyse des données

- [`calculate_auto_thresholds()`](calculate_auto_thresholds.md) :
  Calculer les seuils automatiques (methode quantiles-IQR)
- [`calculate_filter_counts()`](calculate_filter_counts.md) : Calculer
  le nombre de points retires par chaque filtre

## Utilitaires

Fonctions utilitaires pour la manipulation des données

- [`convert_flow_to_yield()`](convert_flow_to_yield.md) : Convertir le
  flux de grain en rendement (boisseaux/acre)
- [`export_raster()`](export_raster.md) : Exporter les donnees nettoyees
  en raster
- [`latlon_to_utm()`](latlon_to_utm.md) : Convertir Latitude/Longitude
  en coordonnees UTM
- [`list_fields_from_zip()`](list_fields_from_zip.md) : Lister les
  champs disponibles dans un fichier ZIP
- [`read_yield_from_zip()`](read_yield_from_zip.md) : Lire les donnees
  de rendement depuis un fichier ZIP
- [`remove_overlap()`](remove_overlap.md) : Supprimer les points en
  chevauchement
- [`save_raster()`](save_raster.md) : Sauvegarder un raster en fichier

# Articles

### Guides d’Utilisation

- [Nettoyage des Données de Rendement](nettoyage_donnees_rendement.md):
- [Utilisation des Données d'Exemple](donnees_exemple.md):
- [Filtres de Nettoyage des Données de Rendement](filtres_nettoyage.md):
